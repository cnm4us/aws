<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin â€¢ Channels</title>
    <link rel="stylesheet" href="/admin-nav.css" />
  </head>
  <body>
    <nav class="sidebar">
      <h1>Admin</h1>
      <a href="/admin/settings">Site Settings</a>
      <a href="/admin/users">Users</a>
      <a href="/admin/groups">Groups</a>
      <a href="/admin/channels">Channels</a>
    </nav>
    <main class="main">
      <div class="section">
        <div style="display:flex; gap:8px; align-items:center;"><a class="btn" href="/admin/channels/new">Add Channel</a></div>
        <div id="status" class="status"></div>
        <table style="margin-top:12px;">
          <thead><tr><th>ID</th><th>Name</th><th>Slug</th><th>Owner</th><th>Actions</th></tr></thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </main>
    <script>
      const csrf=()=>{const m=document.cookie.match(/(?:^|;\s*)csrf=([^;]+)/);return m?decodeURIComponent(m[1]):null};
      const headers=()=>{const h={'Content-Type':'application/json'};const t=csrf(); if(t) h['x-csrf-token']=t; return h};
      async function load(){
        try{
          const res = await fetch('/api/admin/spaces?type=channel', { credentials:'same-origin' });
          const data = await res.json();
          const tbody = document.getElementById('rows'); tbody.innerHTML='';
          for (const s of (data.spaces||[])){
            const tr=document.createElement('tr');
            const owner = s.ownerDisplayName || s.ownerUserId || '';
            const adminLink = `/spaces/${s.id}/admin`;
            tr.innerHTML = `<td>${s.id}</td><td><a href=\"/admin/channels/${s.id}\">${s.name}</a></td><td>${s.slug}</td><td>${owner}</td><td><a class=\"btn\" href=\"${adminLink}\">Admin</a></td>`;
            tbody.appendChild(tr);
          }
        }catch(e){ document.getElementById('status').textContent='Failed to load channels'; document.getElementById('status').className='status error'; }
      }
      load();
    </script>
  </body>
  </html>
