<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin â€¢ Users</title>
    <link rel="stylesheet" href="/admin-nav.css" />
  </head>
  <body>
    <nav class="sidebar">
      <h1>Admin</h1>
      <a href="/admin/settings">Site Settings</a>
      <a href="/admin/users">Users</a>
      <a href="/admin/groups">Groups</a>
      <a href="/admin/channels">Channels</a>
    </nav>
    <main class="main">
      <div class="section">
        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
          <input id="search" type="text" placeholder="Search email or name" />
          <button class="btn" id="searchBtn">Search</button>
          <a class="btn" href="/admin/users/new">Add User</a>
        </div>
        <div id="status" class="status"></div>
        <table style="margin-top:12px;">
          <thead>
            <tr><th>ID</th><th>Display Name</th><th>Email</th><th>Created</th><th>Deleted</th></tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </main>
    <script>
      async function load(){
        const q = document.getElementById('search').value.trim();
        const params = new URLSearchParams(); if(q) params.set('search', q);
        try {
          const res = await fetch(`/api/admin/users?${params.toString()}`, { credentials:'same-origin' });
          const data = await res.json();
          const tbody = document.getElementById('rows'); tbody.innerHTML='';
          (data.users||[]).forEach(u=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${u.id}</td><td><a href="/admin/users/${u.id}">${u.displayName||''}</a></td><td>${u.email}</td><td>${u.createdAt||''}</td><td>${u.deletedAt||''}</td>`;
            tbody.appendChild(tr);
          })
        } catch(e){
          const s=document.getElementById('status'); s.textContent='Failed to load users'; s.className='status error'
        }
      }
      document.getElementById('searchBtn').addEventListener('click', load);
      load();
    </script>
  </body>
  <script src="/js/universal-nav.js" defer></script>
  </html>
